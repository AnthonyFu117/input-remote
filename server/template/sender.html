{% extends 'base.html' %}

{% block title %}Sender{% end %}

{% block style %}
<style>
body
{
  padding: 2em;
}
#pressed
{
  padding: 1em 0 !important;
  min-height: 32px;
}
</style>
{% end %}

{% block content %}
<h3 class="ui header"><i class="icon keyboard"></i> Sender <div id="state" class="ui sub header">Offline</div></h3>
<div class="ui labels" id="pressed"></div>
<input id="input" style="backgound:none;border:none">
{% end %}


{% block scripts %}
<script>
var pressed = {};
var client = new WSClient('ws://'+location.host+'/ws/s','hello',true,true);
client.connect();
client.onkey = function(key) {
  alert(key);
}
client.onstatechange = function(state) {
  if (state) $('#state').addClass('teal').text('Online');
  else $('#state').removeClass('teal').text('Offline');
}
function send_event(event) {
  var obj = {};
  obj.key = event.key;
  obj.keyCode = event.keyCode;
  obj.metaKey = event.metaKey;
  obj.repeat = event.repeat;
  obj.shiftKey = event.shiftKey;
  obj.charCode = event.charCode;
  obj.ctrlKey = event.ctrlKey;
  obj.altKey = event.altKey;
  obj.type = event.type;

  if (obj.type == 'keydown')
    if (pressed[obj.keyCode] == undefined)
    {
        pressed[obj.keyCode] = obj;
        var new_label = $('<div class="ui teal label" code="'+obj.keyCode+'">' + obj.key + '</div>')
        $('#pressed').append(new_label);
    }
    else
      return;
  else
  {
    delete pressed[obj.keyCode];
    $('#pressed [code="'+obj.keyCode+'"]').remove();
  }
  console.log(event,obj);
  client.sendkey(obj);
}
document.addEventListener('keydown', function(event) {
    send_event(event);
    event.preventDefault();
    return false;
});
document.addEventListener('keyup', function(event) {
    send_event(event);
    event.preventDefault();
    return false;
});
</script>
{% end %}
